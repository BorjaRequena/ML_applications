---

title: Homework


keywords: fastai
sidebar: home_sidebar

summary: "Training your own language model"
description: "Training your own language model"
nb_path: "01_homework.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: 01_homework.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>In the lesson we saw how to train a language model with the IMDB dataset and how to use it to create movie reviews. Here, we will take a different dataset and do the same process with a different dataset.</p>
<p>We will consider the dataset of amazon reviews and compare its outputs with a model trained on the IMDB dataset. In order to speed things up, we will consider sub-samples of both datasets as they contain from $10^5$ to $10^6$ reviews. We will work with $\sim10^3$ samples on each dataset.</p>
<p>This would be quite unreasonable to do if we were not using a pre-trained language model. Since we're fine-tunning the language model, it already knows a lot about English and the world, so a few samples will suffice for the training. If we had to build an entire language model from scratch, we would need quite a lot of text.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Movie-reviews">Movie reviews<a class="anchor-link" href="#Movie-reviews"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">path</span> <span class="o">=</span> <span class="n">untar_data</span><span class="p">(</span><span class="n">URLs</span><span class="o">.</span><span class="n">IMDB_SAMPLE</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">dls_lm</span> <span class="o">=</span> <span class="n">DataBlock</span><span class="p">(</span><span class="n">blocks</span><span class="o">=</span><span class="n">TextBlock</span><span class="o">.</span><span class="n">from_df</span><span class="p">(</span><span class="s1">&#39;text&#39;</span><span class="p">,</span> <span class="n">is_lm</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
                   <span class="n">get_x</span><span class="o">=</span><span class="n">ColReader</span><span class="p">(</span><span class="s1">&#39;text&#39;</span><span class="p">),</span> <span class="n">splitter</span><span class="o">=</span><span class="n">RandomSplitter</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>
                   <span class="p">)</span><span class="o">.</span><span class="n">dataloaders</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">path</span><span class="o">/</span><span class="s1">&#39;texts.csv&#39;</span><span class="p">),</span> <span class="n">bs</span><span class="o">=</span><span class="mi">128</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea ">

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Always have a look at the data!</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">dls_lm</span><span class="o">.</span><span class="n">show_batch</span><span class="p">(</span><span class="n">max_n</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea ">
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>text</th>
      <th>text_</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>xxbos xxmaj pathetic is the word . xxmaj bad acting , pathetic script , xxunk dialog and hip hop music &amp; fashion … what the hell was up with that ? xxmaj the xxunk of this movie acts as bad as the movie he made . xxmaj if someone would have taken some time and effort to xxunk the whole thing , it may of had a chance . xxmaj bet the</td>
      <td>xxmaj pathetic is the word . xxmaj bad acting , pathetic script , xxunk dialog and hip hop music &amp; fashion … what the hell was up with that ? xxmaj the xxunk of this movie acts as bad as the movie he made . xxmaj if someone would have taken some time and effort to xxunk the whole thing , it may of had a chance . xxmaj bet the studios</td>
    </tr>
    <tr>
      <th>1</th>
      <td>fear . xxmaj you 'll love it . \n\n xxup xxunk xxbos … you know the rest . xxmaj if you want a good zombie movie , xxup do n't xxup rent xxup this xxup movie . xxmaj if you want a documentary - xxunk look at " hood life " you 're at the wrong place as well . xxmaj if you 're looking for a laughable piece of film ,</td>
      <td>. xxmaj you 'll love it . \n\n xxup xxunk xxbos … you know the rest . xxmaj if you want a good zombie movie , xxup do n't xxup rent xxup this xxup movie . xxmaj if you want a documentary - xxunk look at " hood life " you 're at the wrong place as well . xxmaj if you 're looking for a laughable piece of film , this</td>
    </tr>
    <tr>
      <th>2</th>
      <td>\n\n take one look at john xxunk ' the thing ' . here we have real xxunk , and gore of eerie proportions . 20 years go by and we get this pile of xxunk xxunk crap ' snakes on a plane ' . when are these people going to wake up and xxunk the xxunk ? special effects are going backwards ! \n\n sure you could say .. but the movie</td>
      <td>take one look at john xxunk ' the thing ' . here we have real xxunk , and gore of eerie proportions . 20 years go by and we get this pile of xxunk xxunk crap ' snakes on a plane ' . when are these people going to wake up and xxunk the xxunk ? special effects are going backwards ! \n\n sure you could say .. but the movie is</td>
    </tr>
  </tbody>
</table>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>We're good to train our model. Let's fine-tune a language model from wikipedia.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">imdb_learn</span> <span class="o">=</span> <span class="n">language_model_learner</span><span class="p">(</span><span class="n">dls_lm</span><span class="p">,</span> <span class="n">AWD_LSTM</span><span class="p">,</span> <span class="n">drop_mult</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">metrics</span><span class="o">=</span><span class="p">[</span><span class="n">accuracy</span><span class="p">,</span> <span class="n">Perplexity</span><span class="p">()])</span><span class="o">.</span><span class="n">to_fp16</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">imdb_learn</span><span class="o">.</span><span class="n">fine_tune</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="n">base_lr</span><span class="o">=</span><span class="mf">2e-2</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea ">
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: left;">
      <th>epoch</th>
      <th>train_loss</th>
      <th>valid_loss</th>
      <th>accuracy</th>
      <th>perplexity</th>
      <th>time</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>4.335505</td>
      <td>4.109118</td>
      <td>0.265001</td>
      <td>60.892956</td>
      <td>00:05</td>
    </tr>
  </tbody>
</table>
</div>

</div>

<div class="output_area">


<div class="output_html rendered_html output_subarea ">
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: left;">
      <th>epoch</th>
      <th>train_loss</th>
      <th>valid_loss</th>
      <th>accuracy</th>
      <th>perplexity</th>
      <th>time</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>3.898440</td>
      <td>3.998182</td>
      <td>0.273917</td>
      <td>54.498997</td>
      <td>00:05</td>
    </tr>
    <tr>
      <td>1</td>
      <td>3.776754</td>
      <td>3.986335</td>
      <td>0.273166</td>
      <td>53.857117</td>
      <td>00:05</td>
    </tr>
    <tr>
      <td>2</td>
      <td>3.592028</td>
      <td>3.991039</td>
      <td>0.276539</td>
      <td>54.111095</td>
      <td>00:05</td>
    </tr>
    <tr>
      <td>3</td>
      <td>3.426960</td>
      <td>4.003724</td>
      <td>0.276440</td>
      <td>54.801830</td>
      <td>00:05</td>
    </tr>
  </tbody>
</table>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Let's test the model :)</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">stem</span> <span class="o">=</span> <span class="s2">&quot;Such terrible acting&quot;</span>
<span class="n">pred</span> <span class="o">=</span> <span class="n">imdb_learn</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">stem</span><span class="p">,</span> <span class="n">n_words</span><span class="p">,</span> <span class="n">temperature</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">pred</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea ">

</div>

</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Such terrible acting by Chris Jones is so often disappointing . The story , which has the charm of a classic crime drama , is even worse than the original , which is bad . It &#39;s not enough to be &#34; the twist &#34; , where Jones
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>We can see how this model is notably worse than the one we showed at class trained with the entire dataset, but we're just playing a bit with the concept.</p>
<p>In fact, we can check what would happen if we trained a model without ULMFiT, starting from scratch.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">imdb_learn_0</span> <span class="o">=</span> <span class="n">language_model_learner</span><span class="p">(</span><span class="n">dls_lm</span><span class="p">,</span> <span class="n">AWD_LSTM</span><span class="p">,</span> <span class="n">drop_mult</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">metrics</span><span class="o">=</span><span class="p">[</span><span class="n">accuracy</span><span class="p">,</span> <span class="n">Perplexity</span><span class="p">()],</span> 
                                      <span class="n">pretrained</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">to_fp16</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">imdb_learn_0</span><span class="o">.</span><span class="n">fit_one_cycle</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="n">lr_max</span><span class="o">=</span><span class="mf">5e-2</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea ">
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: left;">
      <th>epoch</th>
      <th>train_loss</th>
      <th>valid_loss</th>
      <th>accuracy</th>
      <th>perplexity</th>
      <th>time</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>6.964747</td>
      <td>6.593917</td>
      <td>0.069173</td>
      <td>730.637085</td>
      <td>00:05</td>
    </tr>
    <tr>
      <td>1</td>
      <td>6.511461</td>
      <td>6.197434</td>
      <td>0.080856</td>
      <td>491.486481</td>
      <td>00:05</td>
    </tr>
    <tr>
      <td>2</td>
      <td>6.317134</td>
      <td>6.088319</td>
      <td>0.080856</td>
      <td>440.679932</td>
      <td>00:05</td>
    </tr>
    <tr>
      <td>3</td>
      <td>6.208774</td>
      <td>6.036022</td>
      <td>0.080856</td>
      <td>418.226105</td>
      <td>00:05</td>
    </tr>
    <tr>
      <td>4</td>
      <td>6.138093</td>
      <td>6.032700</td>
      <td>0.080856</td>
      <td>416.838806</td>
      <td>00:05</td>
    </tr>
  </tbody>
</table>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The model is significantly worse at predicting hte next word (8% accuracy vs 27%). Let's have a look at a prediction</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">stem</span> <span class="o">=</span> <span class="s2">&quot;Such terrible acting&quot;</span>
<span class="n">pred</span> <span class="o">=</span> <span class="n">imdb_learn_0</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">stem</span><span class="p">,</span> <span class="n">n_words</span><span class="p">,</span> <span class="n">temperature</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">pred</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea ">

</div>

</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Such terrible acting 

 From have character Meaning i on THE great Looks two that , , , Out with Well it to . great so Make in &#34; in . . &#39;s Dialogue - the very , his the ,
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Awful &gt;.&lt; These were way too little samples and training for such a model. However, with transfer learning, we have been able to train a somewhat decent model to make movie reviews. Of course, we saw that with more data and training the results are much better.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Amazon-reviews">Amazon reviews<a class="anchor-link" href="#Amazon-reviews"> </a></h2><p>Let's train now a model to generate amazon reviews. This is a much more challenging task, provided that amazon reviews are, generally, awfully written and shorter. Sometimes, it seems that people completely forget that grammar exists!</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">path</span> <span class="o">=</span> <span class="n">untar_data</span><span class="p">(</span><span class="n">URLs</span><span class="o">.</span><span class="n">AMAZON_REVIEWS</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">samples</span> <span class="o">=</span> <span class="mi">5000</span>
<span class="n">a_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">path</span><span class="o">/</span><span class="s2">&quot;train.csv&quot;</span><span class="p">,</span> <span class="n">names</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;label&quot;</span><span class="p">,</span> <span class="s2">&quot;title&quot;</span><span class="p">,</span> <span class="s2">&quot;text&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">samples</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<span class="n">dls_lm</span> <span class="o">=</span> <span class="n">DataBlock</span><span class="p">(</span><span class="n">blocks</span><span class="o">=</span><span class="n">TextBlock</span><span class="o">.</span><span class="n">from_df</span><span class="p">(</span><span class="s1">&#39;text&#39;</span><span class="p">,</span> <span class="n">is_lm</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
                   <span class="n">get_x</span><span class="o">=</span><span class="n">ColReader</span><span class="p">(</span><span class="s1">&#39;text&#39;</span><span class="p">),</span> <span class="n">splitter</span><span class="o">=</span><span class="n">RandomSplitter</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>
                   <span class="p">)</span><span class="o">.</span><span class="n">dataloaders</span><span class="p">(</span><span class="n">a_df</span><span class="p">,</span> <span class="n">bs</span><span class="o">=</span><span class="mi">128</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea ">

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Always have a look at the data! Let's see some reviews.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">dls_lm</span><span class="o">.</span><span class="n">show_batch</span><span class="p">(</span><span class="n">max_n</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea ">
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>text</th>
      <th>text_</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>xxbos xxmaj this book was great in it 's time , but only gets 4 stars as some characters are outdated . i do n't like to make a habit of giving any plot away , but what i will say is xxmaj stephen has a great way of getting the reader to visualize a situation . xxmaj there are situations in this book that as the reader you feel could happen</td>
      <td>xxmaj this book was great in it 's time , but only gets 4 stars as some characters are outdated . i do n't like to make a habit of giving any plot away , but what i will say is xxmaj stephen has a great way of getting the reader to visualize a situation . xxmaj there are situations in this book that as the reader you feel could happen today</td>
    </tr>
    <tr>
      <th>1</th>
      <td>not enjoy anything about this xxup dvd it is rated r and that i must of overlooked because i never would of bought it . i began to watch about 5 minutes into the movie and threw it away . xxmaj it is poorly made the picture and sound is crazy . i watched the previews of the other movies the same company puts out and they were just as bad .</td>
      <td>enjoy anything about this xxup dvd it is rated r and that i must of overlooked because i never would of bought it . i began to watch about 5 minutes into the movie and threw it away . xxmaj it is poorly made the picture and sound is crazy . i watched the previews of the other movies the same company puts out and they were just as bad . i</td>
    </tr>
    <tr>
      <th>2</th>
      <td>minutes than this does in 55 , and costs half as xxunk . xxbos xxmaj good xxunk . xxmaj good for people who do n't have everything . xxmaj these xxunk are of quality gaming value . xxmaj worth a look at the very least and worth the money . xxmaj no experience necessary . xxbos xxmaj enemy xxmaj engaged is a nice game . xxmaj the graphics look great and the</td>
      <td>than this does in 55 , and costs half as xxunk . xxbos xxmaj good xxunk . xxmaj good for people who do n't have everything . xxmaj these xxunk are of quality gaming value . xxmaj worth a look at the very least and worth the money . xxmaj no experience necessary . xxbos xxmaj enemy xxmaj engaged is a nice game . xxmaj the graphics look great and the gameplay</td>
    </tr>
  </tbody>
</table>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>We can now train our model, just as in the IMDB dataset.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">amzn_learn</span> <span class="o">=</span> <span class="n">language_model_learner</span><span class="p">(</span><span class="n">dls_lm</span><span class="p">,</span> <span class="n">AWD_LSTM</span><span class="p">,</span> <span class="n">drop_mult</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">metrics</span><span class="o">=</span><span class="p">[</span><span class="n">accuracy</span><span class="p">,</span> <span class="n">Perplexity</span><span class="p">()])</span><span class="o">.</span><span class="n">to_fp16</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">amzn_learn</span><span class="o">.</span><span class="n">fine_tune</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="n">base_lr</span><span class="o">=</span><span class="mf">2e-2</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea ">
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: left;">
      <th>epoch</th>
      <th>train_loss</th>
      <th>valid_loss</th>
      <th>accuracy</th>
      <th>perplexity</th>
      <th>time</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>4.404650</td>
      <td>4.037593</td>
      <td>0.258091</td>
      <td>56.689747</td>
      <td>00:09</td>
    </tr>
  </tbody>
</table>
</div>

</div>

<div class="output_area">


<div class="output_html rendered_html output_subarea ">
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: left;">
      <th>epoch</th>
      <th>train_loss</th>
      <th>valid_loss</th>
      <th>accuracy</th>
      <th>perplexity</th>
      <th>time</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>3.936937</td>
      <td>3.920053</td>
      <td>0.273897</td>
      <td>50.403091</td>
      <td>00:09</td>
    </tr>
    <tr>
      <td>1</td>
      <td>3.817908</td>
      <td>3.886484</td>
      <td>0.276378</td>
      <td>48.739212</td>
      <td>00:09</td>
    </tr>
    <tr>
      <td>2</td>
      <td>3.632674</td>
      <td>3.889325</td>
      <td>0.276664</td>
      <td>48.877876</td>
      <td>00:09</td>
    </tr>
    <tr>
      <td>3</td>
      <td>3.456472</td>
      <td>3.901219</td>
      <td>0.277141</td>
      <td>49.462727</td>
      <td>00:09</td>
    </tr>
  </tbody>
</table>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">stem</span> <span class="o">=</span> <span class="s2">&quot;Hair dryer&quot;</span>
<span class="n">pred</span> <span class="o">=</span> <span class="n">amzn_learn</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">stem</span><span class="p">,</span> <span class="n">n_words</span><span class="p">,</span> <span class="n">temperature</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">pred</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea ">

</div>

</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Hair dryer is expensive . The product does not work well well ! It is the first clean rock i ever bought and i love it ! i am not using my Hair Style Mixer , but i have had many Paltrow hair charms and i
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The model was not sure about whether it was good or bad, but it does look like an amazon review about a hair dryer.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Model-comparison">Model comparison<a class="anchor-link" href="#Model-comparison"> </a></h2><p>This is where you get creative. Compare the predictions of both models given the same starting points. You can play around and try to find ambiguous starting points, things that work in both contexts (movie reviews and product reviews), completely start deep into one field and see what the opposite model manages to output, etc.</p>
<p>Have a bit of fun!</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">stem</span> <span class="o">=</span> <span class="s2">&quot;Harry Potter never &quot;</span>
<span class="n">pred_amzn</span> <span class="o">=</span> <span class="n">amzn_learn</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">stem</span><span class="p">,</span> <span class="n">n_words</span><span class="p">,</span> <span class="n">temperature</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
<span class="n">pred_imdb</span> <span class="o">=</span> <span class="n">imdb_learn</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">stem</span><span class="p">,</span> <span class="n">n_words</span><span class="p">,</span> <span class="n">temperature</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">pred_amzn</span><span class="o">+</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">pred_imdb</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea ">

</div>

</div>

<div class="output_area">


<div class="output_html rendered_html output_subarea ">

</div>

</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Harry Potter never thinks of his best name . This is n&#39;t really a great story . It is a cute , awesome book that will start to grow like a book . It is just a novel , but i still have to read Harry Potter and

Harry Potter never read the book ( when he was reading his book ) , upon seeing the book , i still thought it was an interesting film . Although it was not great enough to make any sense , the script was excellent . The acting was beautiful , and
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Well, these reviews are not the best ever, but we can see how both know that Harry Potter are books so... I guess I'll take that. Copy/paste this bit of code and experiment a bit. Giving a longer starting point will make the prediction a little bit better. You can test and see what happens when we give it a long input or an empty string.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">stem</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span>
<span class="n">pred_amzn</span> <span class="o">=</span> <span class="n">amzn_learn</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">stem</span><span class="p">,</span> <span class="n">n_words</span><span class="p">,</span> <span class="n">temperature</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
<span class="n">pred_imdb</span> <span class="o">=</span> <span class="n">imdb_learn</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">stem</span><span class="p">,</span> <span class="n">n_words</span><span class="p">,</span> <span class="n">temperature</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">pred_amzn</span><span class="o">+</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">pred_imdb</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea ">

</div>

</div>

<div class="output_area">


<div class="output_html rendered_html output_subarea ">

</div>

</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Interesting phone mariah , it has been a success since . In the last few years we have tried a different model , but it &#39;s too simple and does n&#39;t stay on it , so you want to tell my brother that she was a little too

The British Channel channel ABC . It plays the island sitcom , The Shop on Earth . a local family shop is located on The Grande , and it has a British Food Agency named London
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

</div>
 

